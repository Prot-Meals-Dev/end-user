<div class="popup-container">
    <button class="close-btn" (click)="closePopup()">×</button>

    <div class="popup-headings">
        <h3 *ngIf="isLogin">Already a customer?</h3>
        <h3 *ngIf="!isLogin">Create an account</h3>
        <p *ngIf="isLogin">Welcome back! Sign in for faster checkout.</p>
        <p *ngIf="!isLogin">Please fill out the form to create an account.</p>
    </div>

    <form *ngIf="isLogin" [formGroup]="otpForm" (ngSubmit)="onSubmit()" class="otp-form">
        <div class="input-group email-input">
    <span class="input-icon">
        <i class="bi bi-envelope text-danger"></i>
    </span>

    <input
        formControlName="email"
        type="email"
        placeholder="Enter your email *"
    />
</div>

        <!-- ✅ ERROR MESSAGES -->
        <small class="error"
        *ngIf="otpForm.get('email')?.touched && otpForm.get('email')?.errors?.['required']">
        Email is required
        </small>

        <small class="error"
        *ngIf="otpForm.get('email')?.touched && otpForm.get('email')?.errors?.['email']">
        Enter valid email
        </small>

        <button type="button" class="send-otp-btn" (click)="sendOtp()" *ngIf="!isOtpSent" >
            <ng-container *ngIf="!isSendingOtp; else loadingTpl">Send OTP</ng-container>
        </button>

        <ng-template #loadingTpl>
            <span class="spinner-border spinner-border-sm text-light me-2"></span> Sending...
        </ng-template>

        <div class="otp-inputs" *ngIf="isOtpSent">
            <input maxlength="1" *ngFor="let control of otpArray.controls; let i = index" [formControl]="control"
                (input)="onOtpInput($event, i)" (keydown)="onOtpKeydown($event, i)" #otpInput />
        </div>

        <button type="submit" class="send-otp-btn" *ngIf="isOtpSent">
            Verify OTP
        </button>

        <p class="resend-text" *ngIf="isOtpSent">
            <ng-container *ngIf="counter > 0">
                Resend OTP in <span [style.color]="counter === 0 ? '#C1282D' : '#555'">{{ countdownDisplay }}</span>
            </ng-container>
            <ng-container *ngIf="counter === 0">
                <button type="button" class="resend-otp-btn" (click)="resendOtp()">Resend OTP</button>
            </ng-container>
        </p>

    </form>

    <form *ngIf="!isLogin"
      [formGroup]="signupForm"
      (ngSubmit)="onSignupSubmit()"
      class="otp-form signup-form">

  <!-- FIRST NAME -->
  <input formControlName="firstName" type="text" placeholder="First Name *" />
  <small class="error"
    *ngIf="signupForm.get('firstName')?.touched && signupForm.get('firstName')?.invalid">
    First name is required
  </small>


  <!-- LAST NAME -->
  <input formControlName="lastName" type="text" placeholder="Last Name *" />
  <small class="error"
    *ngIf="signupForm.get('lastName')?.touched && signupForm.get('lastName')?.invalid">
    Last name is required
  </small>


  <!-- PHONE -->
  <input formControlName="phone" type="text" placeholder="Phone Number *" />
  <small class="error"
    *ngIf="signupForm.get('phone')?.touched && signupForm.get('phone')?.errors?.['required']">
    Phone number is required
  </small>
  <small class="error"
    *ngIf="signupForm.get('phone')?.touched && signupForm.get('phone')?.errors?.['pattern']">
    Enter valid 10 digit phone
  </small>


  <!-- EMAIL -->
  <input formControlName="email" type="email" placeholder="Email Address *" />
  <small class="error"
    *ngIf="signupForm.get('email')?.touched && signupForm.get('email')?.errors?.['required']">
    Email is required
  </small>
  <small class="error"
    *ngIf="signupForm.get('email')?.touched && signupForm.get('email')?.errors?.['email']">
    Enter valid email
  </small>


  <!-- REGION -->
  <select formControlName="region">
    <option value="" disabled>Select Region *</option>
    <option *ngFor="let region of allRegions" [value]="region.id">
      {{ region.name }} ({{ region.city }}, {{ region.state }})
    </option>
  </select>
  <small class="error"
    *ngIf="signupForm.get('region')?.touched && signupForm.get('region')?.invalid">
    Please select region
  </small>


  <!-- ADDRESS -->
  <textarea formControlName="address" placeholder="Address *"></textarea>
  <small class="error"
    *ngIf="signupForm.get('address')?.touched && signupForm.get('address')?.invalid">
    Address is required
  </small>


  <button type="submit" class="send-otp-btn">
    Sign Up
  </button>

</form>

    <p class="signup-text" (click)="toggleForm()">
        {{ isLogin ? 'Not a user? Sign Up' : 'Already have an account? Login' }}
    </p>

</div>